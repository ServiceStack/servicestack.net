<!doctype html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TZZ1VK3VGL"></script>
    <script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date()); gtag('config', 'G-TZZ1VK3VGL');</script>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/svg" href="img/logo.svg">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://servicestack.net/feed.xml" />
    <title>Migrating to ASP.NET Core Identity for Authentication - ServiceStack</title>
    <base href="/" />
    <script>
    if (location.search === "?dark") localStorage.setItem('color-scheme','dark') 
    if (location.search === "?light") localStorage.removeItem('color-scheme') 
    const cls = document.querySelector('html').classList
    if (localStorage.getItem('color-scheme') === 'dark')
        cls.add('dark')
    else
        cls.remove('dark')
    </script>
    <link rel="stylesheet" href="css/app.css">

    <script type="importmap">
{
    "imports": {
        "app.mjs": "./mjs/app.mjs",
        "dtos.mjs": "./mjs/dtos.mjs",
        "vue": "./lib/mjs/vue.mjs",
        "@servicestack/client": "./lib/mjs/servicestack-client.mjs",
        "@servicestack/vue": "./lib/mjs/servicestack-vue.mjs",
        "highlight.mjs": "./lib/mjs/highlight.mjs",
        "core": "./js/core.mjs"
    }
}
</script>
    
    <meta name="twitter:site" content="@ServiceStack" />
    <meta name="twitter:card" content="summary" />
    <meta property="og:description" content="A walkthrough of migrating our BlazorDiffusion example application over to ASP.NET Core Identity for authentication" />
    <meta property="og:url" content="https://servicestack.net/posts/identity-migration" />
    <meta property="og:title" content="Migrating to ASP.NET Core Identity for Authentication" />
    <meta property="og:image" content="./img/posts/identity-migration/bg.webp" />


</head>
<body class="bg-white dark:bg-black dark:text-white">
<header class="top-0 fixed z-50 h-14 bg-white dark:bg-black opacity-90 w-full shadow pr-3">
    <div class="w-full flex flex-wrap items-center">
        <div class="absolute z-10 top-2 left-2 sm:static flex-shrink flex-grow-0">
            <div class="cursor-pointer">
                <a class="navbar-brand flex items-center" href="./">
                    <svg class="w-8 h-8 sm:ml-2 sm:w-12 sm:h-12 text-gray-900 dark:text-gray-50" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="currentColor" d="M10 6c1.544 1.76 2.276 4.15 2.217 6.61c3.968 1.67 9.924 6.12 11.181 12.39H28C26.051 14.31 14.918 6.77 10 6zm-2 7c4.67 4.913.81 11.582-4 12h18.97C21.5 18.289 11.95 13.533 8 13z"/></svg>
                    <span class="hidden sm:block text-2xl font-bold text-gray-900 dark:text-gray-50">ServiceStack</span>
                </a>
            </div>
        </div>
        <div class="flex flex-grow flex-shrink flex-nowrap justify-end items-center">
            <nav class="relative flex flex-grow leading-6 font-semibold text-slate-700 dark:text-slate-200">
                <ul class="flex flex-wrap items-center justify-end w-full m-0 pb-2 sm:pb-0">
                            <li class="relative flex flex-wrap just-fu-start m-0">
                                <a href="https://servicestack.net/blog" class="p-4 flex items-center justify-start mw-full hover:text-sky-500 dark:hover:text-sky-400">
                                    Blog
                                </a>
                            </li>
                            <li class="relative flex flex-wrap just-fu-start m-0">
                                <a href="https://servicestack.net/posts/" class="p-4 flex items-center justify-start mw-full hover:text-sky-500 dark:hover:text-sky-400">
                                    Archive
                                </a>
                            </li>
                            <li class="relative flex flex-wrap just-fu-start m-0">
                                <a href="https://servicestack.net/podcasts" class="p-4 flex items-center justify-start mw-full hover:text-sky-500 dark:hover:text-sky-400">
                                    Podcasts
                                </a>
                            </li>
                    <li class="relative flex flex-wrap just-fu-start m-0">
                        <div data-component="DarkModeToggle" class="ml-2 w-10"></div>
                    </li>
                </ul>
            </nav>

        </div>
    </div>
</header>
<script type="module">
import { mountAll } from "app.mjs"
mountAll()
</script>


<div class="min-h-screen">
    <main role="main" class="pt-14">
        



<link rel="stylesheet" href="css/typography.css">
<link rel="stylesheet" href="css/lite-yt-embed.css">

<div class="container px-5 mb-32 mx-auto">
        <article class="mt-20">
            <h1 class="text-6xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">
                Migrating to ASP.NET Core Identity for Authentication
            </h1>
            <div class="flex flex-wrap justify-between">
                <div class="md:mb-12 flex items-center">
                        <a href="posts/author/darren-reid"><img class="w-12 h-12 rounded-full mr-4 text-cyan-600" src="/img/authors/darren.jpg"></a>
                    <div class="flex flex-col">
                            <a class="text-xl font-semibold hover:underline" href="posts/author/darren-reid">Darren Reid</a>
            <ul role="list" class="flex">
                    <li>
                        <a title="Follow on Mastodon" class="mr-1 group flex text-sm font-medium text-zinc-800 transition hover:text-indigo-500 dark:text-zinc-200 dark:hover:text-indigo-500" href="https://reidodon.net/@layoric">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-none text-zinc-500 fill-zinc-500 transition group-hover:fill-indigo-500" width="24" height="24" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M20.94 14c-.28 1.41-2.44 2.96-4.97 3.26c-1.31.15-2.6.3-3.97.24c-2.25-.11-4-.54-4-.54v.62c.32 2.22 2.22 2.35 4.03 2.42c1.82.05 3.44-.46 3.44-.46l.08 1.65s-1.28.68-3.55.81c-1.25.07-2.81-.03-4.62-.5c-3.92-1.05-4.6-5.24-4.7-9.5l-.01-3.43c0-4.34 2.83-5.61 2.83-5.61C6.95 2.3 9.41 2 11.97 2h.06c2.56 0 5.02.3 6.47.96c0 0 2.83 1.27 2.83 5.61c0 0 .04 3.21-.39 5.43M18 8.91c0-1.08-.3-1.91-.85-2.56c-.56-.63-1.3-.96-2.23-.96c-1.06 0-1.87.41-2.42 1.23l-.5.88l-.5-.88c-.56-.82-1.36-1.23-2.43-1.23c-.92 0-1.66.33-2.23.96C6.29 7 6 7.83 6 8.91v5.26h2.1V9.06c0-1.06.45-1.62 1.36-1.62c1 0 1.5.65 1.5 1.93v2.79h2.07V9.37c0-1.28.5-1.93 1.51-1.93c.9 0 1.35.56 1.35 1.62v5.11H18V8.91Z"/>
                            </svg>
                        </a>
                    </li>
                    <li>
                        <a title="Follow on GitHub" class="mr-1 group flex text-sm font-medium text-zinc-800 transition hover:text-indigo-500 dark:text-zinc-200 dark:hover:text-indigo-500" href="https://github.com/layoric">
                            <svg viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6 flex-none text-zinc-500 fill-zinc-500 transition group-hover:fill-indigo-500">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.475 2 2 6.588 2 12.253c0 4.537 2.862 8.369 6.838 9.727.5.09.687-.218.687-.487 0-.243-.013-1.05-.013-1.91C7 20.059 6.35 18.957 6.15 18.38c-.113-.295-.6-1.205-1.025-1.448-.35-.192-.85-.667-.013-.68.788-.012 1.35.744 1.538 1.051.9 1.551 2.338 1.116 2.912.846.088-.666.35-1.115.638-1.371-2.225-.256-4.55-1.14-4.55-5.062 0-1.115.387-2.038 1.025-2.756-.1-.256-.45-1.307.1-2.717 0 0 .837-.269 2.75 1.051.8-.23 1.65-.346 2.5-.346.85 0 1.7.115 2.5.346 1.912-1.333 2.75-1.05 2.75-1.05.55 1.409.2 2.46.1 2.716.637.718 1.025 1.628 1.025 2.756 0 3.934-2.337 4.806-4.562 5.062.362.32.675.936.675 1.897 0 1.371-.013 2.473-.013 2.82 0 .268.188.589.688.486a10.039 10.039 0 0 0 4.932-3.74A10.447 10.447 0 0 0 22 12.253C22 6.588 17.525 2 12 2Z"></path>
                            </svg>
                        </a>
                    </li>
                    <li>
                        <a title="Email Darren Reid" href="mailto:darren@servicestack.com" class="mr-1 group flex text-sm font-medium text-zinc-800 transition hover:text-indigo-500 dark:text-zinc-200 dark:hover:text-indigo-500">
                            <svg class="h-6 w-6 flex-none text-zinc-500 fill-zinc-500 transition group-hover:fill-indigo-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M4 20q-.825 0-1.413-.588T2 18V6q0-.825.588-1.413T4 4h16q.825 0 1.413.588T22 6v12q0 .825-.588 1.413T20 20H4Zm8-7L4 8v10h16V8l-8 5Zm0-2l8-5H4l8 5ZM4 8V6v12V8Z"/></svg>
                        </a>
                    </li>
            </ul>
                    </div>
                </div>
                        <div data-component="pages/podcasts/AudioPlayer.mjs" 
                             data-props="{ id:'identity-migration', title:'Migrating to ASP.NET Core Identity for Authentication', src:'https://media.servicestack.com/podcasts/identity-migration.mp3', beaconUrl:'https://servicestack.net/stats/podcast/record?name=identity-migration&amp;source=post&amp;version=8.8.1', variant:'compact' }"
                             class="mt-4 md:w-[450px] md:mt-0"></div>
                <div class="mb-4 max-w-sm" data-mail="JoinMailingList" data-props="{ submitLabel:'Join our newsletter' }"></div>
            </div>
            
            <div class="mb-8 md:mb-16 sm:mx-0">
                <div class="sm:mx-0">
                    <img src="./img/posts/identity-migration/bg.webp" alt="Migrating to ASP.NET Core Identity for Authentication Background" class="shadow-small">
                </div>
            </div>
            <div class="flex max-w-3xl mx-auto justify-between">
                <div>
                    <div class="mb-4 flex flex-wrap">
                        <a href="posts/tagged/auth" class="mr-2 text-xs leading-5 font-semibold bg-slate-400/10 rounded-full py-1 px-3 flex items-center space-x-2 hover:bg-slate-400/20 dark:highlight-white/5">auth</a>
                        <a href="posts/tagged/identity-auth" class="mr-2 text-xs leading-5 font-semibold bg-slate-400/10 rounded-full py-1 px-3 flex items-center space-x-2 hover:bg-slate-400/20 dark:highlight-white/5">identity-auth</a>
                    </div>
                        <div class="max-w-3xl mx-auto">
                            <div class="mb-6 text-lg text-gray-500">
                                <time datetime="2024-02-06T00:00:00.0000000">February 6, 2024</time>
                                <span aria-hidden="true">&middot;</span>
                                <span>16 min read</span>
                            </div>
                        </div>
                </div>
                <div class="flex flex-grow-0">
                    <div data-post="PostVotes"></div>
                    <a href="javascript:;" onclick="document.location.hash='comments'" class="cursor-pointer" title="Jump to comments">
                        <svg class="ml-4 text-gray-700 mt-1 w-7 h-7" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" d="M3 11.2c0 .1 0 .1 0 0c0 .1 0 .1 0 0zM8.3 1C3.9 1 0 3.6 0 6.6c0 2 1.1 3.7 3 4.7s0 .1 0 .1c-.1 1.3-.9 1.7-.9 1.7L.3 14h2c2.5 0 4.3-1.1 5.1-1.9h.8c4.3 0 7.8-2.5 7.8-5.6S12.6 1 8.3 1zm-.1 10.1H7l-.2.2c-.5.5-1.6 1.4-3.3 1.7c.3-.5.5-1.1.5-2v-.3l-.3-.1C1.9 9.7 1 8.3 1 6.6C1 4.2 4.5 2 8.3 2C12 2 15 4 15 6.6c0 2.4-3.1 4.5-6.8 4.5z"/></svg>
                    </a>
                </div>
            </div>
            <div class="max-w-3xl mx-auto">
                <div id="post" class="prose lg:prose-xl max-w-none mb-32">
                    <h2 id="asp.net-core-identity">ASP.NET Core Identity<a class="header-anchor" href="javascript:;" onclick="location.hash='#asp.net-core-identity'" aria-label="Permalink">&ZeroWidthSpace;</a></h2>
<p>Since the release of ServiceStack v8 we have started to include the use of <a href="https://learn.microsoft.com/en-us/aspnet/core/security/authentication/identity?view=aspnetcore-8.0&amp;tabs=visual-studio">ASP.NET Core Identity for authentication</a> in <a href="https://github.com/NetCoreTemplates">our templates</a>. This gives developers the option to use the built-in ASP.NET Core Identity authentication system or ServiceStack's own authentication system when building their next system.</p>
<p>This provides a closer alignment with the ASP.NET Core ecosystem and allows developers to use the built-in ASP.NET Core Identity authentication system if they are already familiar with it.</p>
<p>If you are already using ServiceStack's authentication system, you can continue to do so, but if you are looking to migrate to ASP.NET Core Identity, this guide will walk you through the process with a concrete example of migrating our <a href="https://github.com/NetCoreApps/BlazorDiffusion">BlazorDiffusion</a> example application.</p>
<h2 id="overview-of-the-migration-process">Overview of the migration process<a class="header-anchor" href="javascript:;" onclick="location.hash='#overview-of-the-migration-process'" aria-label="Permalink">&ZeroWidthSpace;</a></h2>
<p>The migration process can be broken down into the following steps:</p>
<ul>
<li>Add NuGet dependencies</li>
<li>Create ASP.NET Core Identity <code>AspNetUsers</code> class based on your existing custom <code>UserAuth</code> class</li>
<li>Create ASP.NET Core Identity <code>AspNetRoles</code>, ensure matching primary key type to <code>AspNetUsers</code></li>
<li>Create ASP.NET Core Identity <code>ApplicationDbContext</code> class, again matching primary key type to <code>AspNetUsers</code></li>
<li>Create EntityFrameworkCore migration to initialize ASP.NET Core Identity tables</li>
<li>Update <code>AuthFeature</code> registration to use ASP.NET Core Identity</li>
<li>Update <code>Program.cs</code> to use ASP.NET Core Identity</li>
<li>Implement the Migrate Users Task</li>
<li>Migrating Roles</li>
<li>Migrate Foreign Keys from UserAuth to AspNetUsers</li>
</ul>
<p>In this guide we will walk through each of these steps in detail and show how we migrated our BlazorDiffusion example application over to ASP.NET Core Identity to help you with your own migration.</p>
<h3 id="add-asp.net-core-identity-entityframeworkcore-nuget-package">Add ASP.NET Core Identity EntityFrameworkCore NuGet package<a class="header-anchor" href="javascript:;" onclick="location.hash='#add-asp.net-core-identity-entityframeworkcore-nuget-package'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>The first step is to add the required ASP.NET Core Identity NuGet packages to your project. This can be done using the dotnet CLI or via Visual Studio's NuGet package manager.</p>
<div class="shell"><p>dotnet add package Microsoft.AspNetCore.Identity.EntityFrameworkCore
dotnet add package Microsoft.EntityFrameworkCore.Tools</p>
</div>
<p>Since BlazorDiffusion was an existing Blazor project, <a href="https://github.com/NetCoreTemplates/blazor-wasm">we created a new <code>blazor-wasm</code> project</a> using <code>x new blazor-wasm BlazorDiffusion</code> and migrated the Services and Components over to the new project.
We can do this because the <code>blazor-wasm</code> template and others have been <a href="https://docs.servicestack.net/auth/identity-auth">updated to use ASP.NET Core Identity by default</a>. So if your project previously used a ServiceStack template, first check if there is an updated version of the template available with ASP.NET Core Identity support.</p>
<h3 id="create-asp.net-core-identity-aspnetusers-class">Create ASP.NET Core Identity <code>AspNetUsers</code> class<a class="header-anchor" href="javascript:;" onclick="location.hash='#create-asp.net-core-identity-aspnetusers-class'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>Next you will need to create a class that inherits from <code>IdentityUser</code> to represent our users. <a href="https://learn.microsoft.com/en-us/aspnet/core/security/authentication/customize-identity-model?view=aspnetcore-8.0">This class will be used by ASP.NET Core Identity to store user information in the database</a>.
You will want to mirror customizations from your own <code>UserAuth</code> class to this new class which will have the name in the database of <code>AspNetUsers</code>.</p>
<p>To minimize changes, you can rename your existing <code>AppUser</code> class to something like <code>OldUserAuth</code> and then create a new <code>AppUser</code> class that inherits from <code>IdentityUser</code> and copy over any customizations from <code>OldUserAuth</code>.</p>
<div class="info custom-block">
            <p class="custom-block-title">INFO</p><p>In this case <code>AppUser</code> is the name of our custom <code>UserAuth</code> class.</p>
</div>
<p>You will still need to reference your <code>OldAppUser</code> class for migrating users, so you will want to point it to the <code>AppUser</code> table by using the <code>[Alias(&quot;AppUser&quot;)]</code> attribute.</p>
<pre><code class="language-csharp">    [Alias(&quot;AppUser&quot;)]
    public class OldAppUser
    {
        [AutoIncrement]
        public int Id { get; set; }
        public string UserName { get; set; }
        public string DisplayName { get; set; }
        public string FirstName { get; set; }
        public string LastName { get; set; }
        public string? Handle { get; set; }
        public string Email { get; set; }
        public string PasswordHash { get; set; }
        public string? ProfileUrl { get; set; }
        public string? Avatar { get; set; } //overrides ProfileUrl
        public string? LastLoginIp { get; set; }
        public DateTime? LastLoginDate { get; set; }
        public string RefIdStr { get; set; }
        public DateTime? LockedDate { get; set; }
        public DateTime CreatedDate { get; set; }
        public DateTime ModifiedDate { get; set; }
    }
</code></pre>
<p>When creating your new <code>AppUser</code> class, you will want to copy over any customizations from your <code>OldAppUser</code> class. In this case we have added a <code>Handle</code> property to our <code>OldAppUser</code> class, so this will need to be included in the new <code>AppUser</code> class as well.</p>
<p>Essentially your custom EF IdentityUser will want a copy of all the properties you want to migrate other than Id, Email, and PasswordHash that's already defined in the base IdentityUser class.</p>
<pre><code class="language-csharp">// Add profile data for application users by adding properties to the AppUser class
[Alias(&quot;AspNetUsers&quot;)]
public class AppUser : IdentityUser&lt;int&gt;
{
    public string? FirstName { get; set; }
    public string? LastName { get; set; }
    public string? DisplayName { get; set; }
    public string? ProfileUrl { get; set; }
    [Input(Type = &quot;file&quot;), UploadTo(&quot;avatars&quot;)]
    public string? Avatar { get; set; } //overrides ProfileUrl
    public string? Handle { get; set; }
    public int? RefId { get; set; }
    public string RefIdStr { get; set; } = Guid.NewGuid().ToString();
    public bool IsArchived { get; set; }
    public DateTime? ArchivedDate { get; set; }
    public string? LastLoginIp { get; set; }
    public DateTime? LastLoginDate { get; set; }
    public DateTime CreatedDate { get; set; } = DateTime.UtcNow;
    public DateTime ModifiedDate { get; set; } = DateTime.UtcNow;
}
</code></pre>
<h3 id="create-asp.net-core-identity-aspnetroles">Create ASP.NET Core Identity <code>AspNetRoles</code><a class="header-anchor" href="javascript:;" onclick="location.hash='#create-asp.net-core-identity-aspnetroles'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>Next you will need to create a class that inherits from <code>IdentityRole</code> to represent your user roles. This class will be used by ASP.NET Core Identity to store role information in the database.</p>
<pre><code class="language-csharp">[Alias(&quot;AspNetRoles&quot;)]
public class AppRole : IdentityRole&lt;int&gt;
{
    public AppRole() {}
    public AppRole(string roleName) : base(roleName) {}
}
</code></pre>
<p>Again, because our <code>AppUser</code> class is using a different primary key type than the default <code>string</code> type, you will need to specify a matching primary key type for your <code>AppRole</code> class.</p>
<h3 id="create-asp.net-core-identity-applicationdbcontext-class">Create ASP.NET Core Identity <code>ApplicationDbContext</code> class<a class="header-anchor" href="javascript:;" onclick="location.hash='#create-asp.net-core-identity-applicationdbcontext-class'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>Now to use our <code>AppUser</code> and <code>AppRole</code> classes, you will need to create a class that inherits from <code>IdentityDbContext</code> to represent our database context. Just like with any EntityFrameworkCore database context, this class will be used to query and save data to the database.</p>
<pre><code class="language-csharp">public class ApplicationDbContext(DbContextOptions&lt;ApplicationDbContext&gt; options) 
    : IdentityDbContext&lt;AppUser, AppRole, int&gt;(options)
{
    protected override void OnModelCreating(ModelBuilder builder)
    {
        base.OnModelCreating(builder);
        builder.Entity&lt;AppUser&gt;()
            .HasIndex(x =&gt; x.Handle)
            .IsUnique();
    }
}
</code></pre>
<p>Above uses the <code>Handle</code> property on the <code>AppUser</code> class to create a unique index on the <code>Handle</code> column in the <code>AspNetUsers</code> table. You can add other custom restrictions to your schema here as well as needed.</p>
<h3 id="create-entityframeworkcore-migration-to-initialize-asp.net-core-identity-tables">Create EntityFrameworkCore migration to initialize ASP.NET Core Identity tables<a class="header-anchor" href="javascript:;" onclick="location.hash='#create-entityframeworkcore-migration-to-initialize-asp.net-core-identity-tables'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>Now that you have your <code>AppUser</code> and <code>AppRole</code> classes, and can access them via your newly created <code>ApplicationDbContext</code> class, you can create an EntityFrameworkCore migration to initialize the ASP.NET Core Identity tables.</p>
<p><a href="https://learn.microsoft.com/en-us/ef/core/cli/dotnet">You can generate your initial migration using the dotnet CLI or via Visual Studio's Package Manager Console</a>.</p>
<div class="shell"><p>dotnet ef migrations add CreateIdentitySchema</p>
</div>
<p>You should run this command from the AppHost project directory, which in our case is <code>BlazorDiffusion</code>. This will generate your new EntityFrameworkCore migration in the <code>Migrations</code> directory of your AppHost project, along side your ServiceStack migrations.</p>
<p>With your new migration created, you can now update your database schema to include the ASP.NET Core Identity tables.</p>
<div class="shell"><p>dotnet ef database update</p>
</div>
<p>Using the <a href="https://learn.microsoft.com/en-us/ef/core/cli/dotnet">dotnet EntityFramework CLI is great for local development</a>, but for production deployments you will need to run the migrations on your server.
You can do this using ServiceStack's AppTasks feature prior to the standard ServiceStack migrations.</p>
<pre><code class="language-csharp">public class ConfigureDbMigrations : IHostingStartup
{
    public void Configure(IWebHostBuilder builder) =&gt; builder
        .ConfigureAppHost(appHost =&gt; {
            var migrator = new Migrator(appHost.Resolve&lt;IDbConnectionFactory&gt;(), typeof(Migration1000).Assembly);
            AppTasks.Register(&quot;migrate&quot;, _ =&gt;
            {
                var log = appHost.GetApplicationServices().GetRequiredService&lt;ILogger&lt;ConfigureDbMigrations&gt;&gt;();

                log.LogInformation(&quot;Running EF Migrations...&quot;);
                var scopeFactory = appHost.GetApplicationServices().GetRequiredService&lt;IServiceScopeFactory&gt;();
                using (var scope = scopeFactory.CreateScope())
                {
                    using var dbContext = scope.ServiceProvider.GetRequiredService&lt;ApplicationDbContext&gt;();
                    dbContext.Database.EnsureCreated();
                    dbContext.Database.Migrate();
                }
            });
</code></pre>
<p>In the above example we are ensuring the database is created which creates the required schema, and then running the migrations to update the schema to the latest version.</p>
<h3 id="update-authfeature-registration-to-use-asp.net-core-identity">Update <code>AuthFeature</code> registration to use ASP.NET Core Identity<a class="header-anchor" href="javascript:;" onclick="location.hash='#update-authfeature-registration-to-use-asp.net-core-identity'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>With your ASP.NET Core Identity tables created, you can now update your <a href="https://docs.servicestack.net/auth/authentication-and-authorization"><code>AuthFeature</code> registration</a> to use ASP.NET Core Identity.</p>
<pre><code class="language-csharp">public class ConfigureAuth : IHostingStartup
{
    public void Configure(IWebHostBuilder builder) =&gt; builder
        .ConfigureAppHost(appHost =&gt; {
            appHost.Plugins.Add(new AuthFeature(IdentityAuth.For&lt;AppUser,int&gt;(options =&gt; {
                options.EnableCredentialsAuth = true;
                options.SessionFactory = () =&gt; new CustomUserSession();
            })));
        });
}
</code></pre>
<p>In the above example we are using the <code>IdentityAuth</code> class to register ASP.NET Core Identity with ServiceStack. This class is a wrapper around the standard ASP.NET Core Identity registration process and allows you to configure ASP.NET Core Identity options.</p>
<p><a href="https://docs.servicestack.net/auth/migrate-to-identity-auth">ServiceStack uses a compatible Identity v2 password hashing format</a>, which should let you migrate your users to Identity Auth without the need to reset their passwords.</p>
<h3 id="update-program.cs-to-use-asp.net-core-identity">Update <code>Program.cs</code> to use ASP.NET Core Identity<a class="header-anchor" href="javascript:;" onclick="location.hash='#update-program.cs-to-use-asp.net-core-identity'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>Now you will need to configure IdentityCore middleware in your <code>Program.cs</code> file.</p>
<pre><code class="language-csharp">services.AddAuthentication(options =&gt;
    {
        options.DefaultScheme = IdentityConstants.ApplicationScheme;
        options.DefaultSignInScheme = IdentityConstants.ExternalScheme;
    })
    .AddIdentityCookies();
services.AddDataProtection()
    .PersistKeysToFileSystem(new DirectoryInfo(&quot;App_Data&quot;));

// $ dotnet ef migrations add CreateIdentitySchema
// $ dotnet ef database update
var connectionString = config.GetConnectionString(&quot;DefaultConnection&quot;) ?? throw new InvalidOperationException(&quot;Connection string 'DefaultConnection' not found.&quot;);
services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;
    options.UseSqlite(connectionString, b =&gt; b.MigrationsAssembly(nameof(BlazorDiffusion))));
services.AddDatabaseDeveloperPageExceptionFilter();

services.AddIdentityCore&lt;AppUser&gt;(options =&gt; options.SignIn.RequireConfirmedAccount = true)
    .AddRoles&lt;AppRole&gt;()
    .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;()
    .AddSignInManager()
    .AddDefaultTokenProviders();
</code></pre>
<p>Since BlazorDiffusion is a .NET 8 Blazor WASM application, we also needed some additional dependencies setup.</p>
<pre><code class="language-csharp">services.AddCascadingAuthenticationState();
services.AddScoped&lt;IdentityUserAccessor&gt;();
services.AddScoped&lt;IdentityRedirectManager&gt;();
services.AddScoped&lt;AuthenticationStateProvider, PersistingRevalidatingAuthenticationStateProvider&gt;();
</code></pre>
<p>If you are migrating to Identity from an existing Blazor application, our templates have <a href="https://github.com/NetCoreTemplates/blazor-wasm/tree/main/MyApp/Components/Account">tailwind-css styled login and register pages that you can use to get started</a>.</p>
<p>For these, you will also need the additional IdentityEndpoints mapped.</p>
<pre><code class="language-csharp">// Add additional endpoints required by the Identity /Account Razor components.
app.MapAdditionalIdentityEndpoints();
</code></pre>
<h3 id="implement-the-migrate-users-task">Implement the Migrate Users Task<a class="header-anchor" href="javascript:;" onclick="location.hash='#implement-the-migrate-users-task'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>So far we have prepared the application to use ASP.NET Core Identity, but we still need to migrate our existing users to the new ASP.NET Core Identity tables.</p>
<p>This will require:</p>
<ul>
<li>Migrating users from the <code>AppUser</code> table to the <code>AspNetUsers</code> table</li>
<li>Migrating custom roles table to the <code>AspNetRoles</code> table</li>
<li>Migrating foreign keys from the <code>UserAuth</code> table to the <code>AspNetUsers</code> table</li>
<li>Migrating foreign keys from the <code>UserAuthRole</code> table to the <code>AspNetUserRoles</code> table (if any)</li>
</ul>
<p>To do this we will create a new AppTask that will migrate our users to the new ASP.NET Core Identity tables.</p>
<pre><code class="language-csharp">AppTasks.Register(&quot;migrate.users&quot;, _ =&gt; {
    var log = appHost.GetApplicationServices().GetRequiredService&lt;ILogger&lt;ConfigureDbMigrations&gt;&gt;();

    log.LogInformation(&quot;Running migrate.users...&quot;);
    var scopeFactory = appHost.GetApplicationServices().GetRequiredService&lt;IServiceScopeFactory&gt;();
    using var scope = scopeFactory.CreateScope();
    using var dbContext = scope.ServiceProvider.GetRequiredService&lt;ApplicationDbContext&gt;();
    using var db = scope.ServiceProvider.GetRequiredService&lt;IDbConnectionFactory&gt;().Open();
    var migrateUsers = db.Select(db.From&lt;OldAppUser&gt;().OrderBy(x =&gt; x.Id));

    log.LogInformation(&quot;Migrating {Count} Existing ServiceStack Users to Identity Auth Users...&quot;, migrateUsers.Count);
    MigrateExistingUsers(dbContext, scope.ServiceProvider, migrateUsers).Wait();
});
</code></pre>
<p>In the above example we are using the <code>IDbConnectionFactory</code> to open a connection to our database and select all of our existing users from the <code>AppUser</code> table.</p>
<p>The <code>MigrationExistingUsers</code> method will then migrate our existing users to the new ASP.NET Core Identity tables.</p>
<pre><code class="language-csharp">private async Task MigrateExistingUsers(ApplicationDbContext dbContext, IServiceProvider services, 
    List&lt;OldAppUser&gt; migrateUsers, string tempPassword=&quot;p@55wOrd&quot;)
{
    var userManager = services.GetRequiredService&lt;UserManager&lt;AppUser&gt;&gt;();
    var now = DateTime.UtcNow;

    foreach (var user in migrateUsers)
    {
        var appUser = new AppUser
        {
            Id = user.Id,
            UserName = user.Email,
            Email = user.Email,
            DisplayName = user.DisplayName,
            FirstName = user.FirstName,
            LastName = user.LastName,
            Handle = user.Handle,
            ProfileUrl = user.ProfileUrl,
            Avatar = user.Avatar,
            RefIdStr = user.RefIdStr ?? Guid.NewGuid().ToString(),
            LockoutEnabled = true,
            LockoutEnd = user.LockedDate != null ? now.AddYears(10) : now,
            LastLoginDate = user.LastLoginDate,
            LastLoginIp = user.LastLoginIp,
            CreatedDate = user.CreatedDate,
            ModifiedDate = user.ModifiedDate,
            EmailConfirmed = true,
        };
        await userManager.CreateAsync(appUser, tempPassword);
        if (user.PasswordHash != null)
        {
            // Update raw PasswordHash (which uses older ASP.NET Identity v2 format), after users successfully signs in
            // the password will be re-hashed using the latest ASP.NET Identity v3 implementation
            dbContext.Users
                .Where(x =&gt; x.Id == user.Id)
                .ExecuteUpdate(setters =&gt; setters.SetProperty(x =&gt; x.PasswordHash, user.PasswordHash));
        }
    }
}
</code></pre>
<p>In the above example we are using <a href="https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.identity.usermanager-1?view=aspnetcore-8.0">the <code>UserManager</code></a> to create a new <code>AppUser</code> for each of our existing users and then updating the <code>PasswordHash</code> property from the <code>OldAppUser</code> table.</p>
<h3 id="migrating-roles">Migrating Roles<a class="header-anchor" href="javascript:;" onclick="location.hash='#migrating-roles'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>If you are using custom roles, you will also need to migrate these to the new ASP.NET Core Identity tables, and then assign them to your users based on their existing roles in your previous setup.</p>
<p>Your ServiceStack Authentication roles will be stored in the <code>UserAuthRole</code> table separately or in the <code>Roles</code> property of your <code>UserAuth</code> class. You will need to migrate these roles to the new ASP.NET Core Identity tables and then assign them to your users.</p>
<pre><code class="language-csharp">foreach (var roleName in allRoles)
{
    var roleExist = await roleManager.RoleExistsAsync(roleName);
    if (!roleExist)
    {
        //create the roles and seed them to the database
        assertResult(await roleManager.CreateAsync(new AppRole(roleName)));
    }
}
</code></pre>
<p>If your use of roles is static, you can create the list of all your roles from your applications code. If your use of roles is dynamic, you will need to query your database for all the roles that exist in your <code>UserAuthRole</code> table.</p>
<p>One difference between ServiceStack Authentication and ASP.NET Core Identity is the use of the <code>Admin</code> role. In ServiceStack Authentication, the <code>Admin</code> role is a special role that gives the user access to all protected resources. In ASP.NET Core Identity, the <code>Admin</code> role is just a regular role that can be assigned to users.</p>
<p>This means for users with the <code>Admin</code> role in your existing application, additional roles will need to be assigned to them in ASP.NET Core Identity to give them access to the same protected resources.</p>
<p>In BlazorDiffusion we used the Admin role as well as others, but to preserve the existing behavior, we assigned all roles to users with the <code>Admin</code> role.</p>
<pre><code class="language-csharp">foreach (var user in Users.All)
{
    var appUser = new AppUser
    {
        Id = user.Id,
        Email = user.Email,
        DisplayName = user.DisplayName,
        UserName = user.Email,
        Handle = user.Handle,
        Avatar = user.Avatar,
        EmailConfirmed = true,
    };
    if(appUser.Email == &quot;admin@email.com&quot;)
        await EnsureUserAsync(appUser, &quot;p@55wOrd&quot;, AppRoles.All);
    else
        await EnsureUserAsync(appUser, &quot;p@55wOrd&quot;, user.Roles);
}
</code></pre>
<p>The <code>EnsureUserAsync</code> method will assign the roles to the user.</p>
<pre><code class="language-csharp">async Task EnsureUserAsync(AppUser user, string password, string[]? roles = null)
{
    var existingUser = await userManager.FindByEmailAsync(user.Email!);
    if (existingUser != null) return;

    await userManager!.CreateAsync(user, password);
    if (roles?.Length &gt; 0)
    {
        var newUser = await userManager.FindByEmailAsync(user.Email!);
        assertResult(await userManager.AddToRolesAsync(user, roles));
    }
}
</code></pre>
<h3 id="migrate-foreign-keys-from-userauth-to-aspnetusers">Migrate Foreign Keys from UserAuth to AspNetUsers<a class="header-anchor" href="javascript:;" onclick="location.hash='#migrate-foreign-keys-from-userauth-to-aspnetusers'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>If you are using foreign keys in your existing application, you will need to migrate these to the new ASP.NET Core Identity tables.</p>
<p>For databases like PostgreSQL, you can use the <code>ALTER TABLE</code> command to add a foreign key constraint to the <code>AspNetUsers</code> table, and we will want to remove the foreign key constraint from the <code>UserAuth</code> or <code>AppUser</code> table.</p>
<p>In BlazorDiffusion for example, the <code>Creative</code> table was using a foreign key to the <code>AppUser</code> table, so we needed to replace this with a foreign key to the <code>AspNetUsers</code> table.</p>
<pre><code class="language-sql">ALTER TABLE &quot;Creative&quot; DROP CONSTRAINT &quot;FK_Creative_AppUser_UserId&quot;;
ALTER TABLE &quot;Creative&quot; ADD CONSTRAINT &quot;FK_Creative_AspNetUsers_UserId&quot; FOREIGN KEY (&quot;UserId&quot;) REFERENCES &quot;AspNetUsers&quot; (&quot;Id&quot;) ;
</code></pre>
<p>For databases like SQLite, you will need to create a new table with the foreign key constraint and then copy the data over from the old table.</p>
<p>We use SQLite for BlazorDiffusion since it makes it easy deploy the application, and SQLite is a great option for small applications that don't need to scale.</p>
<p>Since we have to migrate several tables, we can create a <code>ReplaceForeignKeyConstraint</code> method to handle this for us.</p>
<pre><code class="language-csharp">private void ReplaceForeignKeyConstraint&lt;TModel&gt;()
{
    var modelDef = typeof(TModel).GetModelMetadata();
    
    var createTable = SqliteDialect.Provider.ToCreateTableStatement(typeof(TModel));

    var sql = $@&quot;PRAGMA foreign_keys = OFF;
ALTER TABLE {modelDef.ModelName} RENAME TO {modelDef.ModelName}_old;
{createTable}
INSERT INTO {modelDef.ModelName} SELECT * FROM {modelDef.ModelName}_old;
-- DROP TABLE {modelDef.ModelName}_old;
PRAGMA foreign_keys = ON;&quot;;
    Db.ExecuteSql(sql);
}
</code></pre>
<p>When replacing the tables like this, you will need to be aware of the order in which you replace the tables. For example, if you have a foreign key from the <code>Creative</code> table to the <code>AppUser</code> table, and a foreign key from the <code>Artifact</code> table to the <code>Creative</code> table, you will need to replace the <code>Creative</code> table first, and then the <code>Artifact</code> table.</p>
<p>This is because the <code>Artifact</code> table has a foreign key to the <code>Creative</code> table, and if you replace the <code>Artifact</code> table first, the foreign key will still be pointing to the old <code>Creative</code> table.</p>
<h4 id="incorrect-migration-order-result">Incorrect migration order result<a class="header-anchor" href="javascript:;" onclick="location.hash='#incorrect-migration-order-result'" aria-label="Permalink">&ZeroWidthSpace;</a></h4>
<div class="my-8 ml-20 flex justify-center">
    <img style="max-height:450px" src="/img/posts/identity-migration/incorrect-mapping-diagram.png" alt="Incorrect DB mapping after migration.">
</div>
<h4 id="correct-migration-order-result">Correct migration order result<a class="header-anchor" href="javascript:;" onclick="location.hash='#correct-migration-order-result'" aria-label="Permalink">&ZeroWidthSpace;</a></h4>
<div class="my-8 ml-20 flex justify-center">
    <img style="max-height:450px" src="/img/posts/identity-migration/correct-mapping-diagram.png" alt="Correct DB mapping after migration.">
</div>
<p>The rule of thumb is you will want to replace the tables from most depended on to least depended on.</p>
<p>Another limitation of the SQL above is that the order of the columns in the new table must match the order of the columns in the old table. <code>INSERT INTO</code> will insert the data into the new table based on the order of the columns in the new table, so if the order of the columns is different, the data will be inserted into the wrong columns.</p>
<p>During the migration of BlazorDiffusion, we hit this issue with the <code>Artifact</code> table. The <code>Artifact</code> C# class uses the <code>AuditBase</code> base class which has the <code>CreatedDate</code> and <code>ModifiedDate</code> properties. In a previous migration we added some additional columns as features were added. So when creating a copy of the <code>Artifact</code> class in the ServiceStack migration to handle fixing the foreign key, the order of the columns was different.</p>
<p>Thankfully, since internal classes used in migrations are completely separate for repeatable migrations, we can just create the <code>Artfact</code> class to be specific for this migration. So instead of inheriting from <code>AuditBase</code>, we can just copy the properties from <code>AuditBase</code> into the <code>Artifact</code> class in the order required.</p>
<p>Putting it all together, we have a migration <code>Up</code> method that looks like:</p>
<pre><code class="language-csharp">public override void Up()
{
    var appHost = HostContext.AppHost;
    var log = appHost.GetApplicationServices().GetRequiredService&lt;ILogger&lt;ConfigureDbMigrations&gt;&gt;();
    
    log.LogInformation(&quot;Migrating FKs from AppUser to AspNetUsers...&quot;);
    ReplaceForeignKeyConstraint&lt;Creative&gt;();
    ReplaceForeignKeyConstraint&lt;Artifact&gt;();
    ReplaceForeignKeyConstraint&lt;Album&gt;();
    
    ReplaceForeignKeyConstraint&lt;ArtifactLike&gt;();
    ReplaceForeignKeyConstraint&lt;ArtifactComment&gt;();
    ReplaceForeignKeyConstraint&lt;ArtifactCommentReport&gt;();
    
    ReplaceForeignKeyConstraint&lt;AlbumArtifact&gt;();
    ReplaceForeignKeyConstraint&lt;AlbumLike&gt;();
    
    ReplaceForeignKeyConstraint&lt;CreativeModifier&gt;();
    ReplaceForeignKeyConstraint&lt;CreativeArtist&gt;();
    
    ReplaceForeignKeyConstraint&lt;ArtifactCommentVote&gt;();
    
    ReplaceForeignKeyConstraint&lt;ArtifactReport&gt;();
}
</code></pre>
<p>In a separate migration, we can then drop the old tables after confirming the migration was successful, and the previous data has been migrated to the new tables.</p>
<pre><code class="language-csharp">public class Migration1007 : MigrationBase
{
    public override void Up()
    {
        DropOldTable&lt;Migration1006.AlbumLike&gt;();
        DropOldTable&lt;Migration1006.AlbumArtifact&gt;();
        DropOldTable&lt;Migration1006.Album&gt;();
        
        DropOldTable&lt;Migration1006.ArtifactLike&gt;();
        DropOldTable&lt;Migration1006.ArtifactCommentReport&gt;();
        DropOldTable&lt;Migration1006.ArtifactCommentVote&gt;();
        DropOldTable&lt;Migration1006.ArtifactComment&gt;();
        DropOldTable&lt;Migration1006.ArtifactReport&gt;();
        DropOldTable&lt;Migration1006.Artifact&gt;();
        
        DropOldTable&lt;Migration1006.CreativeArtist&gt;();
        DropOldTable&lt;Migration1006.CreativeModifier&gt;();
        DropOldTable&lt;Migration1006.Creative&gt;();
    }
    
    private void DropOldTable&lt;TModel&gt;()
    {
        var modelDef = typeof(TModel).GetModelMetadata();
        Db.ExecuteSql($@&quot;PRAGMA foreign_keys = OFF;
DROP TABLE IF EXISTS {modelDef.ModelName}_old;
PRAGMA foreign_keys = ON;&quot;);
    }
}
</code></pre>
<h3 id="migrate-foreign-keys-from-userauthrole-to-aspnetuserroles">Migrate Foreign Keys from UserAuthRole to AspNetUserRoles<a class="header-anchor" href="javascript:;" onclick="location.hash='#migrate-foreign-keys-from-userauthrole-to-aspnetuserroles'" aria-label="Permalink">&ZeroWidthSpace;</a></h3>
<p>If you have any tables that use a foreign key to your custom <code>UserAuthRole</code> table, you will need to do the same as above and migrate these to the new ASP.NET Core Identity tables.</p>
<h2 id="why-migrate-to-asp.net-core-identity">Why Migrate to ASP.NET Core Identity?<a class="header-anchor" href="javascript:;" onclick="location.hash='#why-migrate-to-asp.net-core-identity'" aria-label="Permalink">&ZeroWidthSpace;</a></h2>
<p>ServiceStack's built-in authentication system is a great option for many applications. It provides a simple and easy to use authentication system that works out of the box with ServiceStack's built-in features like Sessions, Caching, and OrmLite.</p>
<p>However, as a part of making ServiceStack more compatible with the ASP.NET Core ecosystem, we have started to include the use of ASP.NET Core Identity since a lot of ASP.NET developers are already familiar with it.</p>
<p>It also provides features like two-factor authentication, external authentication providers, and more that are not available in ServiceStack's built-in authentication system.</p>
<p><img src="/img/posts/identity-migration/two-factor-auth-example.png" alt="" /></p>
<p>So while you don't have to migrate to ASP.NET Core Identity, it is a great option if you are already familiar with it, or if you are looking to use some of the additional features it provides.</p>
<p>If you are looking to migrate to ASP.NET Core Identity, we hope this guide helps you with your migration. If you have any questions, feel free to reach out on our <a href="https://forums.servicestack.net">forums</a>.</p>

                </div>
            </div>
        </article>
</div>

<div id="comments" data-post="PostComments" class="my-48"></div>

        <div class="bg-gray-50 py-20">
            <div class="max-w-3xl mx-auto">
                <div class="flex justify-between">
                    <div>
                            <a href="posts/author/darren-reid"><img class="w-20 h-20 rounded-full text-cyan-600" src="/img/authors/darren.jpg"></a>

                        <div class="mt-2 font-medium text-2xl">
                            Written by Darren Reid
                        </div>
                        <div class="text-gray-600">
                            Developer @ServiceStack, Tech author &#x2B; consultant, renewable energy nerd, fetcher of treats for 2 Greyhounds.
                        </div>
                    </div>
                    <div class="flex items-end">
            <ul role="list" class="flex">
                    <li>
                        <a title="Follow on Mastodon" class="mr-1 group flex text-sm font-medium text-zinc-800 transition hover:text-indigo-500 dark:text-zinc-200 dark:hover:text-indigo-500" href="https://reidodon.net/@layoric">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-none text-zinc-500 fill-zinc-500 transition group-hover:fill-indigo-500" width="24" height="24" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M20.94 14c-.28 1.41-2.44 2.96-4.97 3.26c-1.31.15-2.6.3-3.97.24c-2.25-.11-4-.54-4-.54v.62c.32 2.22 2.22 2.35 4.03 2.42c1.82.05 3.44-.46 3.44-.46l.08 1.65s-1.28.68-3.55.81c-1.25.07-2.81-.03-4.62-.5c-3.92-1.05-4.6-5.24-4.7-9.5l-.01-3.43c0-4.34 2.83-5.61 2.83-5.61C6.95 2.3 9.41 2 11.97 2h.06c2.56 0 5.02.3 6.47.96c0 0 2.83 1.27 2.83 5.61c0 0 .04 3.21-.39 5.43M18 8.91c0-1.08-.3-1.91-.85-2.56c-.56-.63-1.3-.96-2.23-.96c-1.06 0-1.87.41-2.42 1.23l-.5.88l-.5-.88c-.56-.82-1.36-1.23-2.43-1.23c-.92 0-1.66.33-2.23.96C6.29 7 6 7.83 6 8.91v5.26h2.1V9.06c0-1.06.45-1.62 1.36-1.62c1 0 1.5.65 1.5 1.93v2.79h2.07V9.37c0-1.28.5-1.93 1.51-1.93c.9 0 1.35.56 1.35 1.62v5.11H18V8.91Z"/>
                            </svg>
                        </a>
                    </li>
                    <li>
                        <a title="Follow on GitHub" class="mr-1 group flex text-sm font-medium text-zinc-800 transition hover:text-indigo-500 dark:text-zinc-200 dark:hover:text-indigo-500" href="https://github.com/layoric">
                            <svg viewBox="0 0 24 24" aria-hidden="true" class="h-6 w-6 flex-none text-zinc-500 fill-zinc-500 transition group-hover:fill-indigo-500">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.475 2 2 6.588 2 12.253c0 4.537 2.862 8.369 6.838 9.727.5.09.687-.218.687-.487 0-.243-.013-1.05-.013-1.91C7 20.059 6.35 18.957 6.15 18.38c-.113-.295-.6-1.205-1.025-1.448-.35-.192-.85-.667-.013-.68.788-.012 1.35.744 1.538 1.051.9 1.551 2.338 1.116 2.912.846.088-.666.35-1.115.638-1.371-2.225-.256-4.55-1.14-4.55-5.062 0-1.115.387-2.038 1.025-2.756-.1-.256-.45-1.307.1-2.717 0 0 .837-.269 2.75 1.051.8-.23 1.65-.346 2.5-.346.85 0 1.7.115 2.5.346 1.912-1.333 2.75-1.05 2.75-1.05.55 1.409.2 2.46.1 2.716.637.718 1.025 1.628 1.025 2.756 0 3.934-2.337 4.806-4.562 5.062.362.32.675.936.675 1.897 0 1.371-.013 2.473-.013 2.82 0 .268.188.589.688.486a10.039 10.039 0 0 0 4.932-3.74A10.447 10.447 0 0 0 22 12.253C22 6.588 17.525 2 12 2Z"></path>
                            </svg>
                        </a>
                    </li>
                    <li>
                        <a title="Email Darren Reid" href="mailto:darren@servicestack.com" class="mr-1 group flex text-sm font-medium text-zinc-800 transition hover:text-indigo-500 dark:text-zinc-200 dark:hover:text-indigo-500">
                            <svg class="h-6 w-6 flex-none text-zinc-500 fill-zinc-500 transition group-hover:fill-indigo-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M4 20q-.825 0-1.413-.588T2 18V6q0-.825.588-1.413T4 4h16q.825 0 1.413.588T22 6v12q0 .825-.588 1.413T20 20H4Zm8-7L4 8v10h16V8l-8 5Zm0-2l8-5H4l8 5ZM4 8V6v12V8Z"/></svg>
                        </a>
                    </li>
            </ul>
                    </div>
                </div>

                <div class="mt-4 border-t">
                    <div class="py-8 text-lg text-gray-700 font-medium">
                        More from Darren Reid
                    </div>
                    <div class="grid grid-cols-2 gap-8">
                            <div>
                                <div class="flex flex-col overflow-hidden">
                                    <div class="flex-shrink-0">
                                        <a href="posts/kamal-deployments">
                                            <img class="h-48 w-full object-cover" src="./img/posts/kamal-deployments/bg.webp" alt="">
                                        </a>
                                    </div>
                                    <div class="flex flex-1 flex-col justify-between bg-white dark:bg-black p-6">
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-indigo-600 dark:text-indigo-300">
                                                Article
                                            </p>
                                            <a href="posts/kamal-deployments" class="mt-2 block">
                                                <p class="text-xl font-semibold text-gray-900 dark:text-gray-50 whitespace-nowrap overflow-hidden text-ellipsis" title=".NET 8 Templates migrated to use Kamal for deployments">
                                                    .NET 8 Templates migrated to use Kamal for deployments
                                                </p>
                                                <p class="mt-3 text-base text-gray-500">All Identity Auth templates now use Kamal for deployments, simplifying the process of deploying .NET Apps to any Linux server.</p>
                                            </a>
                                        </div>
                                        <div class="mt-6 flex items-center">
                                            <div class="flex-shrink-0">
                                                <a href="">
                                                    <span class="sr-only">Darren Reid</span>
                                                    <img class="h-10 w-10 rounded-full" src="/img/authors/darren.jpg" alt=".NET 8 Templates migrated to use Kamal for deployments background">
                                                </a>
                                            </div>
                                            <div class="ml-3">
                                                <p class="text-sm font-medium text-gray-900">
                                                        <a href="posts/author/darren-reid" class="hover:underline">Darren Reid</a>
                                                </p>
                                                <div class="flex space-x-1 text-sm text-gray-500">
                                                    <time datetime="2024-12-05T00:00:00.0000000">December 5, 2024</time>
                                                    <span aria-hidden="true">&middot;</span>
                                                    <span>5 min read</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div>
                                <div class="flex flex-col overflow-hidden">
                                    <div class="flex-shrink-0">
                                        <a href="posts/redis-outputcache">
                                            <img class="h-48 w-full object-cover" src="./img/posts/redis-outputcache/bg.webp" alt="">
                                        </a>
                                    </div>
                                    <div class="flex flex-1 flex-col justify-between bg-white dark:bg-black p-6">
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-indigo-600 dark:text-indigo-300">
                                                Article
                                            </p>
                                            <a href="posts/redis-outputcache" class="mt-2 block">
                                                <p class="text-xl font-semibold text-gray-900 dark:text-gray-50 whitespace-nowrap overflow-hidden text-ellipsis" title="Using ASP.NET Core Output Caching">
                                                    Using ASP.NET Core Output Caching
                                                </p>
                                                <p class="mt-3 text-base text-gray-500">How to use ASP.NET Core Output Caching to cache the response of a ServiceStack Service using ServiceStack.Redis</p>
                                            </a>
                                        </div>
                                        <div class="mt-6 flex items-center">
                                            <div class="flex-shrink-0">
                                                <a href="">
                                                    <span class="sr-only">Darren Reid</span>
                                                    <img class="h-10 w-10 rounded-full" src="/img/authors/darren.jpg" alt="Using ASP.NET Core Output Caching background">
                                                </a>
                                            </div>
                                            <div class="ml-3">
                                                <p class="text-sm font-medium text-gray-900">
                                                        <a href="posts/author/darren-reid" class="hover:underline">Darren Reid</a>
                                                </p>
                                                <div class="flex space-x-1 text-sm text-gray-500">
                                                    <time datetime="2024-06-05T00:00:00.0000000">June 5, 2024</time>
                                                    <span aria-hidden="true">&middot;</span>
                                                    <span>5 min read</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div>
                                <div class="flex flex-col overflow-hidden">
                                    <div class="flex-shrink-0">
                                        <a href="posts/asp-rate-limiter-middleware">
                                            <img class="h-48 w-full object-cover" src="./img/posts/asp-rate-limiter-middleware/bg.webp" alt="">
                                        </a>
                                    </div>
                                    <div class="flex flex-1 flex-col justify-between bg-white dark:bg-black p-6">
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-indigo-600 dark:text-indigo-300">
                                                Article
                                            </p>
                                            <a href="posts/asp-rate-limiter-middleware" class="mt-2 block">
                                                <p class="text-xl font-semibold text-gray-900 dark:text-gray-50 whitespace-nowrap overflow-hidden text-ellipsis" title="Using ASP.NET Core Rate Limiter Middleware">
                                                    Using ASP.NET Core Rate Limiter Middleware
                                                </p>
                                                <p class="mt-3 text-base text-gray-500">Learn how to use the new Rate Limiter Middleware in ServiceStack to protect your APIs from abuse.</p>
                                            </a>
                                        </div>
                                        <div class="mt-6 flex items-center">
                                            <div class="flex-shrink-0">
                                                <a href="">
                                                    <span class="sr-only">Darren Reid</span>
                                                    <img class="h-10 w-10 rounded-full" src="/img/authors/darren.jpg" alt="Using ASP.NET Core Rate Limiter Middleware background">
                                                </a>
                                            </div>
                                            <div class="ml-3">
                                                <p class="text-sm font-medium text-gray-900">
                                                        <a href="posts/author/darren-reid" class="hover:underline">Darren Reid</a>
                                                </p>
                                                <div class="flex space-x-1 text-sm text-gray-500">
                                                    <time datetime="2024-04-08T00:00:00.0000000">April 8, 2024</time>
                                                    <span aria-hidden="true">&middot;</span>
                                                    <span>6 min read</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div>
                                <div class="flex flex-col overflow-hidden">
                                    <div class="flex-shrink-0">
                                        <a href="posts/blazor-8-admin">
                                            <img class="h-48 w-full object-cover" src="./img/posts/blazor-8-admin/bg.webp" alt="">
                                        </a>
                                    </div>
                                    <div class="flex flex-1 flex-col justify-between bg-white dark:bg-black p-6">
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-indigo-600 dark:text-indigo-300">
                                                Article
                                            </p>
                                            <a href="posts/blazor-8-admin" class="mt-2 block">
                                                <p class="text-xl font-semibold text-gray-900 dark:text-gray-50 whitespace-nowrap overflow-hidden text-ellipsis" title="New Blazor Interactive Auto Template with Custom Admin UIs">
                                                    New Blazor Interactive Auto Template with Custom Admin UIs
                                                </p>
                                                <p class="mt-3 text-base text-gray-500">Discover how to use ServiceStack.Blazor components to quickly create customizable and professional-looking admin pages in a Blazor application</p>
                                            </a>
                                        </div>
                                        <div class="mt-6 flex items-center">
                                            <div class="flex-shrink-0">
                                                <a href="">
                                                    <span class="sr-only">Darren Reid</span>
                                                    <img class="h-10 w-10 rounded-full" src="/img/authors/darren.jpg" alt="New Blazor Interactive Auto Template with Custom Admin UIs background">
                                                </a>
                                            </div>
                                            <div class="ml-3">
                                                <p class="text-sm font-medium text-gray-900">
                                                        <a href="posts/author/darren-reid" class="hover:underline">Darren Reid</a>
                                                </p>
                                                <div class="flex space-x-1 text-sm text-gray-500">
                                                    <time datetime="2024-02-26T00:00:00.0000000">February 26, 2024</time>
                                                    <span aria-hidden="true">&middot;</span>
                                                    <span>7 min read</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                    </div>
                </div>
            </div>
        </div>

<script type="module">
import { init } from "app.mjs"
init()
</script>

<link rel="stylesheet" href="css/highlight.css">
<script src="js/highlight.js"></script>
<script>hljs.highlightAll()</script>
<script src="js/lite-yt-embed.js"></script>
<script src="mjs/docs.mjs" type="module"></script>


<script type="module">
import { mount } from "app.mjs"

    const App = {
        setup() {
            function nav(url) {
                window.open(url)
            }
            return { nav }
        }
    }
    mount('#post', App)
</script>

    </main>
</div>

<footer class="bg-slate-200 dark:bg-black border-t border-slate-300 dark:border-gray-600 py-8 sm:py-12">
    <div class="max-w-screen-2xl mx-auto px-5">
        <div class="sm:flex sm:flex-wrap sm:-mx-4 md:py-4">
            <div class="px-4 sm:w-1/2 md:w-1/4 xl:w-1/6">
                <h5 class="block uppercase text-slate-500 font-semibold mb-4">Features</h5>
                <div>
                    <a href="https://servicestack.net/service-reference" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">ServiceStack Reference</a>
                    <a href="https://servicestack.net/creatorkit/" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">CreatorKit</a>
                    <a href="https://servicestack.net/litestream" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Litestream</a>
                    <a href="https://servicestack.net/ormlite" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">OrmLite</a>
                    <a href="https://servicestack.net/redis" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Redis</a>
                    <a href="https://servicestack.net/locode" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Locode</a>
                    <a href="https://www.jamstacks.net" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Jamstack</a>
                </div>
            </div>
            <div class="px-4 sm:w-1/2 md:w-1/4 xl:w-1/6 mt-8 sm:mt-0">
                <h5 class="block uppercase text-slate-500 font-semibold mb-4">Resources</h5>
                <div>
                    <a href="https://docs.servicestack.net" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Framework Docs</a>
                    <a href="https://forums.servicestack.net" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Customer Forums</a>
                    <a href="https://docs.servicestack.net/redis/" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">ServiceStack.Redis</a>
                    <a href="https://docs.servicestack.net/ormlite/" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">ServiceStack.OrmLite</a>
                    <a href="https://docs.servicestack.net/text" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">ServiceStack.Text</a>
                    <a href="https://docs.servicestack.net/aws" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">ServiceStack.Aws</a>
                    <a href="https://github.com/NetCoreApps/LiveDemos" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Live Demos</a>
                    <a href="https://servicestack.net/posts/" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Blog Archive</a>
                </div>
            </div>
            <div class="px-4 sm:w-1/2 md:w-1/4 xl:w-1/6 mt-8 md:mt-0">
                <h5 class="block uppercase text-slate-500 font-semibold mb-4">Learn</h5>
                <div>
                    <a href="https://docs.servicestack.net/why-servicestack" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Why ServiceStack</a>
                    <a href="https://docs.servicestack.net/architecture-overview" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Architecture</a>
                    <a href="https://docs.servicestack.net/explore-servicestack" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Explore ServiceStack</a>
                    <a href="https://docs.servicestack.net/api-first-development" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">API First Development</a>
                    <a href="https://docs.servicestack.net/service-complexity-and-dto-roles" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">The Simple POCO Life</a>
                    <a href="https://servicestack.net/training" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Training Services</a>
                </div>
            </div>
            <div class="px-4 sm:w-1/2 md:w-1/4 xl:w-1/6 mt-8 md:mt-0">
                <h5 class="block uppercase text-slate-500 font-semibold mb-4">About</h5>
                <div>
                    <a href="https://servicestack.net/support" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Support</a>
                    <a href="https://servicestack.net/whatsnew" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">What's New</a>
                    <a href="https://servicestack.net/#contact" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Contact Us</a>
                    <a href="https://servicestack.net/privacy" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Privacy</a>
                    <a href="https://servicestack.net/terms" class="text-slate-600 hover:text-slate-800 dark:hover:text-slate-100 font-semibold block pb-2 text-sm">Terms</a>
                </div>
            </div>
            <div class="px-4 mt-4 flex justify-end">
                <div class="max-w-sm">
                    <div class="mx-auto">
                        <h5 class="block uppercase text-slate-500 font-semibold mb-4">Stay connected</h5>

                        <div class="mt-6 lg:mb-0 mb-6">
                            <a href="https://twitter.com/ServiceStack" class="inline-block bg-white dark:bg-gray-800 p-2 text-blue-400 shadow-lg font-normal items-center justify-center align-center rounded-full outline-none focus:outline-none mr-2">
                                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M22.46 6c-.77.35-1.6.58-2.46.69c.88-.53 1.56-1.37 1.88-2.38c-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29c0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15c0 1.49.75 2.81 1.91 3.56c-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07a4.28 4.28 0 0 0 4 2.98a8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21C16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56c.84-.6 1.56-1.36 2.14-2.23Z"/></svg>
                            </a>
                            <a href="https://www.youtube.com/channel/UC0kXKGVU4NHcwNdDdRiAJSA" class="inline-block bg-white dark:bg-gray-800 p-2 text-red-600 shadow-lg font-normal items-center justify-center align-center rounded-full outline-none focus:outline-none mr-2">
                                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M21.543 6.498C22 8.28 22 12 22 12s0 3.72-.457 5.502c-.254.985-.997 1.76-1.938 2.022C17.896 20 12 20 12 20s-5.893 0-7.605-.476c-.945-.266-1.687-1.04-1.938-2.022C2 15.72 2 12 2 12s0-3.72.457-5.502c.254-.985.997-1.76 1.938-2.022C6.107 4 12 4 12 4s5.896 0 7.605.476c.945.266 1.687 1.04 1.938 2.022zM10 15.5l6-3.5l-6-3.5v7z"/></svg>
                            </a>
                            <a href="https://github.com/ServiceStack" class="inline-block bg-white dark:bg-gray-800 p-2 text-slate-800 shadow-lg font-normal items-center justify-center align-center rounded-full outline-none focus:outline-none mr-2">
                                <svg class="h-6 w-6 dark:text-white" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5c.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34c-.46-1.16-1.11-1.47-1.11-1.47c-.91-.62.07-.6.07-.6c1 .07 1.53 1.03 1.53 1.03c.87 1.52 2.34 1.07 2.91.83c.09-.65.35-1.09.63-1.34c-2.22-.25-4.55-1.11-4.55-4.92c0-1.11.38-2 1.03-2.71c-.1-.25-.45-1.29.1-2.64c0 0 .84-.27 2.75 1.02c.79-.22 1.65-.33 2.5-.33c.85 0 1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02c.55 1.35.2 2.39.1 2.64c.65.71 1.03 1.6 1.03 2.71c0 3.82-2.34 4.66-4.57 4.91c.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg>
                            </a>
                        </div>
                    </div>
                    <div class="mt-8" data-mail="JoinMailingList" data-props="{ submitLabel:'Join our newsletter' }"></div>
                </div>
            </div>
        </div>

        <div class="sm:flex sm:flex-wrap sm:-mx-4 mt-6 pt-6 sm:mt-12 sm:pt-12 border-t dark:border-gray-700">
            <div class="sm:w-full px-4 md:w-1/6">
                <b>About ServiceStack</b>
            </div>
            <div class="px-4 sm:w-1/2 mt-4 md:mt-0 text-sm text-gray-600">
                ServiceStack started development in 2008 with the mission of creating a best-practices services framework
                with an emphasis on simplicity and speed, reducing the effort in creating and maintaining resilient
                message-based SOA Services and rich web apps like <a href="https://pvq.app">pvq</a>.

                <p class="pt-2">Copyright (c) ServiceStack Inc. 2024</p>
            </div>
            <div class="px-4 md:w-1/4 md:ml-auto mt-6 sm:mt-4 md:mt-0">
                <a href="https://servicestack.net/start"
                   class="bg-slate-800 text-white active:bg-slate-600 text-sm font-semibold uppercase px-6 py-3 rounded shadow hover:shadow-lg outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150">
                    Get started
                </a>
            </div>
        </div>        
        
    </div>
</footer>

<script type="module">
import { mail } from 'https://creatorkit.servicestack.net/mjs/components/mail.mjs'
import { post } from 'https://creatorkit.servicestack.net/mjs/components/post.mjs'

mail('[data-mail]', { mailingLists:['MonthlyNewsletter'] })
post('[data-post]', {
    commentLink: { 
        href: '/community-rules',
        label: 'read the community rules'
    } 
})
</script>


<script type="module">
import { init } from "app.mjs"
init()
</script>



</body>
</html>